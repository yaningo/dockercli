version: 2.1

orbs:
  win: circleci/windows@5.0.0

jobs:
  build:
    executor:
      name: win/default
    environment:
      APP_VERSION: "4.5.0"

    steps:
      - run:
          shell: bash
          command: |
            while true; do
              sleep 5
              date
              # systeminfo | find "Available Physical Memory"
              wmic OS get FreePhysicalMemory
              echo "======"
            done
          background: true
      - run:
#           shell: powershell.exe
          command: |
            # $ErrorActionPreference = 'Stop'
            $ErrorActionPreference
            New-Item -Path "c:\tmp" -Name "testfile1.txt" -ItemType "file" -Value "This is a text string."
            Get-Item C:\tmpa\* -Filter "*.txt" | Remove-Item -Force
            Get-Item C:\tmp\*
            sleep 10
            # Import-Module "$env:ProgramData\Chocolatey\helpers\chocolateyProfile.psm1"
            $env:APP_VERSION
            $LA_VERSION = "1.2.3"
            setx APP_VERSION $LA_VERSION
            $env:APP_VERSION
            refreshenv
            $env:APP_VERSION

      - run:
#           shell: powershell.exe
          command: |
            $env:APP_VERSION

workflows:
  whatos:
    jobs:
      - build
#           context: ravinder
